pico-8 cartridge // http://www.pico-8.com
version 27
__lua__
function _init()
 cls()
 t=0
 player = {
  x=60,
  y=60,
  dx=0,
  dy=0,
  sp=1,
  boundary = {
  x1=0,
  y1=0,
  x2=120,
  y2=120
  }
 }
 template = {
  ghost = {
   sp = 2,
   dr = 50,
   dx = -1,
   dy = 0,
  },
  witch = {
   name = "witch",
   sp = 3,
   sw = 2,
   sh = 2,
   dr = 90,
   dx = -1,
   dy = 0,
  }
 }
 monsters = {}
end

function maybe_spawn(template, extra)
 if ((t % template.dr) == 0) then
  e = spawn(template, extra)
  printh("drawing thing at " .. dump(e))
  add(monsters, e)
 end
end

function _update()
 t += 1
 maybe_spawn(template.ghost, {x=(rndi(80) + 20), y=(rndi(100) + 10), dx=(-rnd(2))})
 maybe_spawn(template.witch, {x=110, y=(rndi(100) + 10)})
 for monster in all(monsters) do
  move_sprite(monster)
 end
 controls()
end

function spawn(template, extra)
 local e = copy(template)
 printh("merging " .. dump(extra) .. " into " .. dump(e))
 merge(e, extra)
 return e
end

function controls()
 if btn(⬆️) and player.y > player.boundary.y1 then
  player.y = player.y - 1
 end
 if btn(⬇️) and player.y < player.boundary.y2 then
  player.y = player.y + 1
 end
 if btn(⬅️) and player.x > player.boundary.x1 then
  player.x = player.x - 1
 end
 if btn(➡️) and player.x < player.boundary.x2 then
  player.x = player.x + 1
 end
end


function _draw()
 cls()
 spr(1, player.x, player.y)
 for monster in all(monsters) do
  draw_sprite(monster)
 end
end

function move_sprite(s)
 if (s.name == "witch") then
  s.ddy = (rnd(0.5) - 0.25)
  s.ddx = (rnd(0.5) - 0.25)
 end
 s.dx = s.dx + (s.ddx or 0)
 s.dy = s.dy + (s.ddy or 0)
 s.x = s.x + s.dx
 s.y = s.y + s.dy
end

function draw_sprite(s)
 w = s.sw or 1
 h = s.sh or 1
 spr(s.sp, s.x, s.y, w, h)
end

function rndi(n)
 return flr(rnd(n))
end

function copy(a)
 local n = {}
 for k,v in pairs(a) do n[k] = v end
 return n
end

function merge(a,b)
 for k,v in pairs(b) do a[k] = v end
end

function dump(tbl)
 s = ""
 for k,v in pairs(tbl) do
  s = s .. k .. "=" .. v .. ","
 end
 return s
end


__gfx__
00000000000000005677765000000000550055000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000006777776500000055555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700099009907707077600000055555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000099009907777777600000000555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000aa0007777777640006666660500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000aa0006700076504666066660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000088008805677765000044466600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000008888000566650000006666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000006006440000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000006066044444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000006606004455440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000600604454540000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000604544500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000004004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000004400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000010000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
